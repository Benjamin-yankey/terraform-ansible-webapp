# Architecture Diagram Explanation

## Overview

This document explains the architecture diagram for the Terraform + Ansible Web Application Deployment project. The diagram illustrates the complete infrastructure provisioning and application deployment workflow.

## Components

### 1. Developer Machine (Local Environment)

**Terraform (v1.5.0+)**
- Infrastructure as Code tool
- Files: main.tf, variables.tf, outputs.tf
- Provisions AWS resources
- Generates dynamic inventory and SSH keys

**Dynamic Inventory (hosts.ini)**
- Auto-generated by Terraform
- Contains EC2 instance IP and connection details
- Used by Ansible for configuration management

**SSH Key Pair**
- Private key: ssh-key.pem (chmod 400)
- Public key: Deployed to EC2 instance
- Enables secure SSH access

**Ansible (v2.14+)**
- Configuration management tool
- Files: site.yml, roles/webserver, ansible.cfg
- Installs and configures Nginx
- Deploys web application

### 2. AWS Cloud (eu-west-1 Region)

**VPC (Virtual Private Cloud)**
- Default VPC used
- Provides network isolation
- Contains all AWS resources

**Internet Gateway**
- Enables internet connectivity
- Routes traffic between VPC and internet

**Security Group (terraform-ansible-webapp-sg)**
- Inbound Rules:
  - SSH (Port 22): 196.61.44.164/32 (restricted IP)
  - HTTP (Port 80): 0.0.0.0/0 (public access)
- Outbound Rules:
  - All Traffic: 0.0.0.0/0

**EC2 Instance**
- Instance Type: t3.micro
- AMI: Amazon Linux 2023
- Storage: 30GB EBS (gp3)
- Environment: dev
- Hosts Nginx and web application

**Nginx Web Server**
- Port: 80 (HTTP)
- Status: Active & Enabled
- Serves web application content

**Web Application**
- Location: /usr/share/nginx/html/index.html
- Static HTML content
- Accessible via HTTP

**Elastic IP**
- Static public IPv4 address
- Attached to EC2 instance
- Enables consistent public access

**AWS Key Pair**
- Name: terraform-ansible-webapp-key
- Stored in AWS
- Used for EC2 SSH authentication

## Deployment Flow

### Step 1: Terraform Initialization & Provisioning
- Command: `terraform init && terraform apply`
- Provisions: VPC, Security Group, EC2, Elastic IP, Key Pair
- Creates AWS infrastructure

### Step 2: Generate Dynamic Inventory
- Terraform outputs EC2 details
- Creates hosts.ini file
- Contains IP address and connection parameters

### Step 3: Create & Download SSH Key
- Terraform generates key pair
- Downloads private key locally
- Sets proper permissions (chmod 400)

### Step 4: Ansible Authentication Setup
- Ansible uses downloaded SSH key
- Configures connection to EC2
- Prepares for configuration management

### Step 5: Ansible Configuration
- Command: `ansible-playbook site.yml`
- Connects via SSH (Port 22)
- Installs Nginx web server
- Deploys web application files

### Step 6: User HTTP Request
- End user accesses application
- Command: `curl http://<ELASTIC_IP>`
- Port: 80 (HTTP)
- Routes through Internet Gateway

### Step 7: HTTP Response
- Nginx processes request
- Returns: 200 OK status
- Delivers HTML content to user

## Network Flow

1. **Provisioning**: Developer → Terraform → AWS API → VPC/EC2
2. **Configuration**: Developer → Ansible → SSH (Port 22) → EC2
3. **Access**: End User → Internet → IGW → Elastic IP → EC2 (Port 80) → Nginx

## Security

- SSH access restricted to specific IP (196.61.44.164/32)
- HTTP access open to public (0.0.0.0/0)
- Private SSH key stored locally with restricted permissions
- Security Group acts as virtual firewall

## Tools & Versions

- Terraform: 1.5.0+
- Ansible: 2.14+
- AWS CLI: Configured with credentials
- Project: terraform-ansible-webapp
- Environment: dev

## Cleanup

To destroy all resources:
```bash
terraform destroy -auto-approve
```

## File Location

The architecture diagram is available at:
- `architecture-diagram.drawio` (editable in draw.io)
